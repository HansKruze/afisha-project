<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Авторизация</title>
    <link rel="stylesheet" href="style_login2.css">
    <link rel="stylesheet" href="style_login.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
</head>
<body>

<div class="screen">
    <!-- Декор сверху -->
    <div class="circles-top">
        <div class="circle green"></div>
        <div class="circle pink"></div>
        <div class="circle orange"></div>
    </div>

    <!-- Контент -->
    <div class="container">

        <a href="index.html" class="back-arrow">←</a>

        <h1>Авторизация</h1>
        <p class="subtitle">Введите код из сообщения</p>
            
        <div class="code-inputs">
            <input type="text" inputmode="numeric" maxlength="1">
            <input type="text" inputmode="numeric" maxlength="1">
            <input type="text" inputmode="numeric" maxlength="1">
            <input type="text" inputmode="numeric" maxlength="1">
            <input type="text" inputmode="numeric" maxlength="1">
            <input type="text" inputmode="numeric" maxlength="1">
        </div>

        <p class="resend">Отправить код заново (00:00)</p>

        <button id="confirmBtn" class="btn">Войти</button>

    </div>

    <!-- Декор снизу -->
    <div class="circles-bottom">
        <div class="circle green"></div>
        <div class="circle pink"></div>
        <div class="circle orange"></div>
    </div>
</div>








<script>
const inputs = document.querySelectorAll('.code-inputs input');

inputs.forEach((input, index) => {

    input.addEventListener('input', () => {
        // оставляем только цифры
        input.value = input.value.replace(/\D/g, '');

        // если ввели цифру — прыгаем дальше
        if (input.value && index < inputs.length - 1) {
            inputs[index + 1].focus();
        }
    });

    input.addEventListener('keydown', (e) => {
        // если Backspace и поле пустое — идём назад
        if (e.key === 'Backspace' && !input.value && index > 0) {
            inputs[index - 1].focus();
        }
    });

});
</script>






<script>
document.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') {
        document.querySelector('.btn').click();
    }
});
</script>







<script>
document.getElementById('confirmBtn').addEventListener('click', async () => {
    const phone = localStorage.getItem('authPhone');
    const normalizedPhone = phone.replace(/\D/g, '');

    if (!phone) {
        alert('Сначала введите номер телефона');
        window.location.href = 'login.html';
        return;
    }

    const inputs = document.querySelectorAll('.code-inputs input');
    let code = '';
    inputs.forEach(i => code += i.value);

    if (code.length < 6) {
        alert('Введите код полностью');
        return;
    }

    try {
        const response = await fetch('http://localhost:5194/api/auth/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ phone: normalizedPhone, code })
        });

        if (!response.ok) throw new Error();

        localStorage.setItem('isAuth', 'true');
        localStorage.removeItem('authPhone');

        window.location.href = 'index.html';

    } catch {
        alert('Неверный код');
    }
});
</script>

</body>
</html>
